<!doctype html>
<html lang="th">

<head>
  <meta charset="utf-8">
  <title>
    <%= title || 'SNG Logistics | ขนส่งไทย-ลาว' %>
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Libraries -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Custom Premium CSS -->
  <link rel="stylesheet" href="/css/luxury.css">
</head>

<body class="page-surface text-slate-100 antialiased selection:bg-amber-100 selection:text-amber-900">
  <!-- Navigation Bar -->
  <!-- Navigation Bar -->
  <!-- Navigation Bar -->
  <% if (currentUser) { %>
    <nav class="bg-slate-900/95 border-b border-white/5 text-white shadow-lg sticky top-0 z-50 backdrop-blur-sm">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-4 gap-6">

          <!-- Brand -->
          <a href="/dashboard" class="flex items-center gap-3 group">
            <img src="/images/snglogo.png" alt="SNG" class="w-10 h-10 object-contain">
            <div class="flex flex-col leading-tight">
              <span class="font-bold text-lg tracking-tight text-white">
                SNG <span class="text-amber-500">LOGISTICS</span>
              </span>
              <span class="text-[10px] text-slate-400 uppercase tracking-widest font-medium">Thailand ▸ Laos
                Border</span>
            </div>
          </a>

          <!-- Navigation Menu -->
          <div class="hidden lg:flex items-center gap-1 bg-slate-800/50 p-1.5 rounded-xl border border-white/5">
            <a href="/dashboard"
              class="px-4 py-2 rounded-lg text-sm font-medium transition-all hover:bg-white/5 hover:text-white flex items-center gap-2 <%= (typeof title !== 'undefined' && title.includes('ภาพรวม')) ? 'bg-indigo-600 text-white shadow-md' : 'text-white' %>">
              <i class="fa-solid fa-chart-pie mb-0.5"></i> ภาพรวม
            </a>
            <a href="/orders"
              class="px-4 py-2 rounded-lg text-sm font-medium transition-all hover:bg-white/5 hover:text-white flex items-center gap-2 <%= (typeof title !== 'undefined' && title.includes('ออเดอร์')) ? 'bg-indigo-600 text-white shadow-md' : 'text-white' %>">
              <i class="fa-solid fa-box mb-0.5"></i> ออเดอร์
            </a>
            <a href="/trips"
              class="px-4 py-2 rounded-lg text-sm font-medium transition-all hover:bg-white/5 hover:text-white flex items-center gap-2 <%= (typeof title !== 'undefined' && title.includes('รอบรถ')) ? 'bg-indigo-600 text-white shadow-md' : 'text-white' %>">
              <i class="fa-solid fa-truck-fast mb-0.5"></i> รอบรถ
            </a>
            <a href="/customers"
              class="px-4 py-2 rounded-lg text-sm font-medium transition-all hover:bg-white/5 hover:text-white flex items-center gap-2 <%= (typeof title !== 'undefined' && title.includes('ลูกค้า')) ? 'bg-indigo-600 text-white shadow-md' : 'text-white' %>">
              <i class="fa-solid fa-users mb-0.5"></i> ลูกค้า
            </a>
            <a href="/cod"
              class="px-4 py-2 rounded-lg text-sm font-medium transition-all hover:bg-white/5 hover:text-white flex items-center gap-2 <%= (typeof title !== 'undefined' && title.includes('การเงิน')) ? 'bg-indigo-600 text-white shadow-md' : 'text-white' %>">
              <i class="fa-solid fa-wallet mb-0.5"></i> การเงิน
            </a>
            <% if (currentUser && currentUser.role==='admin' ) { %>
              <a href="/users"
                class="px-4 py-2 rounded-lg text-sm font-medium transition-all hover:bg-white/5 hover:text-white flex items-center gap-2 <%= (typeof title !== 'undefined' && title.includes('ผู้ใช้งาน')) ? 'bg-indigo-600 text-white shadow-md' : 'text-white' %>">
                <i class="fa-solid fa-users-gear mb-0.5"></i> ผู้ใช้งาน
              </a>
              <a href="/settings/rates"
                class="px-4 py-2 rounded-lg text-sm font-medium transition-all hover:bg-white/5 hover:text-white flex items-center gap-2 <%= (typeof title !== 'undefined' && title.includes('ราคาขนส่ง')) ? 'bg-indigo-600 text-white shadow-md' : 'text-white' %>">
                <i class="fa-solid fa-tags mb-0.5"></i> ราคาขนส่ง
              </a>
              <% } %>
                <% if (currentUser && ['admin', 'manager' ].includes(currentUser.role)) { %>
                  <a href="/whatsapp"
                    class="px-4 py-2 rounded-lg text-sm font-medium transition-all hover:bg-white/5 hover:text-white flex items-center gap-2 <%= (typeof title !== 'undefined' && title.includes('WhatsApp')) ? 'bg-indigo-600 text-white shadow-md' : 'text-white' %>">
                    <i class="fa-brands fa-whatsapp mb-0.5"></i> WhatsApp
                  </a>
                  <% } %>
          </div>

          <div class="flex items-center gap-3">
            <!-- Theme Toggle -->
            <button id="theme-toggle"
              class="w-9 h-9 rounded-lg bg-slate-800 hover:bg-slate-700 border border-slate-700 text-amber-400 hover:text-amber-300 flex items-center justify-center transition-all shadow-lg shadow-amber-900/10">
              <i class="fa-solid fa-sun text-lg" id="theme-icon"></i>
            </button>

            <a href="/orders/new"
              class="hidden md:inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500 text-white text-sm font-bold shadow-lg shadow-emerald-900/20 transition-all">
              <i class="fa-solid fa-plus"></i> <span class="hidden lg:inline">สร้างออเดอร์</span>
            </a>

            <div class="flex items-center gap-4 pl-4 border-l border-white/10">
              <% if (currentUser) { %>
                <div class="hidden md:flex flex-col items-end">
                  <span class="text-sm font-bold text-white tracking-wide">
                    <%= currentUser.username %>
                  </span>
                  <span
                    class="text-[10px] px-2 py-0.5 bg-slate-800 text-slate-300 rounded border border-white/10 uppercase font-bold tracking-wider">
                    <%= currentUser.role %>
                  </span>
                </div>
                <form action="/logout" method="post">
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                  <button
                    class="w-9 h-9 rounded-lg bg-slate-800 hover:bg-red-900/50 border border-slate-700 hover:border-red-500/50 text-slate-400 hover:text-red-400 flex items-center justify-center transition-all">
                    <i class="fa-solid fa-power-off"></i>
                  </button>
                </form>
                <% } else { %>
                  <a href="/login"
                    class="px-6 py-2 rounded-lg bg-amber-500 hover:bg-amber-600 text-white text-sm font-bold shadow-md transition-all">เข้าสู่ระบบ</a>
                  <% } %>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <% } %>

      <!-- Main Content -->
      <main class="max-w-7xl mx-auto p-6 md:p-8 animate-fade-in min-h-[calc(100vh-200px)]">
        <% if (flash) { %>
          <div
            class="mb-8 p-5 rounded-3xl shadow-2xl flex items-center gap-4 border animate-fade-in <%= flash.type === 'error' ? 'bg-red-500/10 border-red-500/20 text-red-100' : 'bg-emerald-500/10 border-emerald-500/20 text-emerald-100' %>">
            <div
              class="w-12 h-12 rounded-2xl flex items-center justify-center shrink-0 <%= flash.type === 'error' ? 'bg-red-500/20 text-red-400' : 'bg-emerald-500/20 text-emerald-400' %>">
              <i
                class="<%= flash.type === 'error' ? 'fa-solid fa-triangle-exclamation' : 'fa-solid fa-circle-check' %> text-xl"></i>
            </div>
            <div>
              <h4 class="font-bold text-xs uppercase tracking-[0.18em] mb-1 opacity-80">
                <%= flash.type==='error' ? 'System Alert' : 'Success' %>
              </h4>
              <p class="font-bold text-lg">
                <%= flash.message %>
              </p>
            </div>
          </div>
          <% } %>

            <%- body %>
      </main>

      <!-- Footer -->
      <footer
        class="mt-12 py-4 text-center text-slate-100/60 text-xs font-medium border-t border-white/5 bg-white/5 backdrop-blur-sm">
        <p class="mb-1">&copy; <%= new Date().getFullYear() %> SNG Logistics (Thailand-Laos).</p>
        <p>ระบบขนส่งสำหรับทีมมืออาชีพ ภายใต้การดูแลของบริษัท SNG CO,prehensive Sevice Co.,Ltd.</p>
      </footer>

      <script>
        // Theme Toggling Logic
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const html = document.documentElement;

        // Check Local Storage
        const currentTheme = localStorage.getItem('theme');
        if (currentTheme === 'light') {
          document.body.classList.add('light-mode');
          themeIcon.classList.replace('fa-sun', 'fa-moon');
          themeIcon.parentElement.classList.replace('bg-slate-800', 'bg-white');
          themeIcon.parentElement.classList.replace('text-amber-400', 'text-indigo-600');
        }

        themeToggleBtn.addEventListener('click', () => {
          document.body.classList.toggle('light-mode');

          if (document.body.classList.contains('light-mode')) {
            localStorage.setItem('theme', 'light');
            themeIcon.classList.replace('fa-sun', 'fa-moon');
            // Button style for light mode
            themeToggleBtn.classList.remove('bg-slate-800', 'text-amber-400', 'border-slate-700');
            themeToggleBtn.classList.add('bg-white', 'text-indigo-600', 'border-slate-200');
          }
        });
      </script>

      <style>
        @keyframes pulse-once {
          0% {
            transform: scale(0.98);
            opacity: 0.8;
          }

          50% {
            transform: scale(1.01);
            opacity: 1;
          }

          100% {
            transform: scale(1);
          }
        }

        .animate-pulse-once {
          animation: pulse-once 0.4s ease-out;
        }
      </style>

</body>

</html>