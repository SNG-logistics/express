<!doctype html>
<html lang="th">

<head>
  <meta charset="utf-8">
  <title>
    <%= title || 'SNG Logistics | ขนส่งไทย-ลาว' %>
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Libraries -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Custom Premium CSS -->
  <link rel="stylesheet" href="/css/luxury.css">
  <style>
    /* Prevent FOUC (Flash of Unstyled Content) */
    html {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>

<body class="antialiased selection:bg-amber-500 selection:text-white">
  <!-- Navigation Bar -->
  <% if (currentUser) { %>
    <nav class="sticky top-0 z-50 backdrop-blur-md shadow-lg transition-all duration-300">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-3 gap-6">

          <!-- Brand -->
          <a href="/dashboard" class="flex items-center gap-3 group">
            <img src="/images/snglogo.png" alt="SNG" class="object-contain transition-transform group-hover:scale-105"
              style="width: 45px; height: 45px;">
            <div class="flex flex-col leading-tight">
              <span class="font-bold text-lg tracking-tight text-main">
                SNG <span class="text-gold">LOGISTICS</span>
              </span>
              <span class="text-[10px] text-muted uppercase tracking-widest font-medium">Thailand ▸ Laos Border</span>
            </div>
          </a>

          <!-- Navigation Menu -->
          <div class="hidden lg:flex items-center gap-1.5 p-1.5 rounded-xl border border-color bg-[var(--bg-glass)]">
            <a href="/dashboard"
              class="nav-link text-sm font-medium flex items-center gap-2 <%= (typeof title !== 'undefined' && title.includes('ภาพรวม')) ? 'active font-bold text-indigo' : '' %>">
              <i class="fa-solid fa-chart-pie mb-0.5"></i> ภาพรวม
            </a>
            <a href="/orders"
              class="nav-link text-sm font-medium flex items-center gap-2 <%= (typeof title !== 'undefined' && title.includes('ออเดอร์')) ? 'active font-bold text-indigo' : '' %>">
              <i class="fa-solid fa-box mb-0.5"></i> ออเดอร์
            </a>
            <a href="/trips"
              class="nav-link text-sm font-medium flex items-center gap-2 <%= (typeof title !== 'undefined' && title.includes('รอบรถ')) ? 'active font-bold text-indigo' : '' %>">
              <i class="fa-solid fa-truck-fast mb-0.5"></i> รอบรถ
            </a>
            <a href="/customers"
              class="nav-link text-sm font-medium flex items-center gap-2 <%= (typeof title !== 'undefined' && title.includes('ลูกค้า')) ? 'active font-bold text-indigo' : '' %>">
              <i class="fa-solid fa-users mb-0.5"></i> ลูกค้า
            </a>
            <a href="/cod"
              class="nav-link text-sm font-medium flex items-center gap-2 <%= (typeof title !== 'undefined' && title.includes('การเงิน')) ? 'active font-bold text-indigo' : '' %>">
              <i class="fa-solid fa-wallet mb-0.5"></i> การเงิน
            </a>

            <% if (currentUser && ['admin', 'manager' ].includes(currentUser.role)) { %>
              <div class="w-px h-6 bg-slate-500/20 mx-1"></div>
              <% if (currentUser.role==='admin' ) { %>
                <a href="/users" class="nav-link text-xs flex items-center gap-1 opacity-80 hover:opacity-100">
                  <i class="fa-solid fa-users-gear"></i> ทีมงาน
                </a>
                <a href="/settings/rates" class="nav-link text-xs flex items-center gap-1 opacity-80 hover:opacity-100">
                  <i class="fa-solid fa-tags"></i> ราคา
                </a>
                <% } %>
                  <a href="/whatsapp"
                    class="nav-link text-xs flex items-center gap-1 text-emerald-500/90 hover:text-emerald-500 font-bold">
                    <i class="fa-brands fa-whatsapp"></i> WA
                  </a>
                  <% } %>
          </div>

          <!-- User & Actions -->
          <div class="flex items-center gap-4">
            <!-- Theme Toggle -->
            <button id="theme-toggle"
              class="w-10 h-10 rounded-xl border border-color flex items-center justify-center transition-all hover:bg-white/5 text-gold hover:scale-110">
              <i class="fa-solid fa-sun text-lg" id="theme-icon"></i>
            </button>

            <a href="/orders/new"
              class="hidden md:inline-flex items-center gap-2 btn-gold text-sm shadow-lg shadow-amber-500/20">
              <i class="fa-solid fa-plus"></i> <span class="hidden lg:inline">สร้างออเดอร์</span>
            </a>

            <div class="flex items-center gap-4 pl-4 border-l border-color">
              <% if (currentUser) { %>
                <div class="hidden md:flex flex-col items-end">
                  <span class="text-sm font-bold text-main tracking-wide">
                    <%= currentUser.username %>
                  </span>
                  <span
                    class="text-[10px] px-2 py-0.5 rounded border border-color bg-white/5 text-muted uppercase font-bold tracking-wider">
                    <%= currentUser.role %>
                  </span>
                </div>
                <form action="/logout" method="post">
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                  <button
                    class="w-9 h-9 rounded-lg hover:bg-red-500/10 border border-transparent hover:border-red-500/30 text-muted hover:text-red-400 flex items-center justify-center transition-all">
                    <i class="fa-solid fa-power-off"></i>
                  </button>
                </form>
                <% } else { %>
                  <a href="/login" class="btn-gold text-sm shadow-md">เข้าสู่ระบบ</a>
                  <% } %>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <% } %>

      <!-- Main Content -->
      <main class="max-w-7xl mx-auto p-4 md:p-8 animate-fade-in-up min-h-[calc(100vh-200px)]">
        <% if (flash) { %>
          <div
            class="mb-8 p-5 rounded-2xl shadow-2xl flex items-center gap-4 border animate-fade-in-up backdrop-blur-md <%= flash.type === 'error' ? 'bg-red-500/10 border-red-500/20 text-red-400' : 'bg-emerald-500/10 border-emerald-500/20 text-emerald-400' %>">
            <div class="text-2xl">
              <i
                class="<%= flash.type === 'error' ? 'fa-solid fa-triangle-exclamation' : 'fa-solid fa-circle-check' %>"></i>
            </div>
            <div>
              <h4 class="font-bold text-xs uppercase tracking-[0.18em] mb-1 opacity-80">
                <%= flash.type==='error' ? 'System Alert' : 'Success' %>
              </h4>
              <p class="font-bold text-lg text-main">
                <%= flash.message %>
              </p>
            </div>
          </div>
          <% } %>

            <%- body %>
      </main>

      <!-- Footer -->
      <footer
        class="mt-12 py-6 text-center text-muted text-xs font-medium border-t border-color bg-[var(--bg-glass)] backdrop-blur-sm">
        <p class="mb-1">&copy; <%= new Date().getFullYear() %> SNG Logistics (Thailand-Laos).</p>
        <p class="opacity-60">ระบบขนส่งสำหรับทีมมืออาชีพ ภายใต้การดูแลของบริษัท SNG Comprehensive Service Co.,Ltd.</p>
      </footer>

      <script>
        // Theme Toggling Logic (Simplified)
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');

        // Check Local Storage on Load
        if (localStorage.getItem('theme') === 'light') {
          document.body.classList.add('light-mode');
          if (themeIcon) themeIcon.classList.replace('fa-sun', 'fa-moon');
        }

        if (themeToggleBtn) {
          themeToggleBtn.addEventListener('click', () => {
            document.body.classList.toggle('light-mode');
            const isLight = document.body.classList.contains('light-mode');

            // Update Icon
            if (isLight) {
              themeIcon.classList.replace('fa-sun', 'fa-moon');
              localStorage.setItem('theme', 'light');
            } else {
              themeIcon.classList.replace('fa-moon', 'fa-sun');
              localStorage.setItem('theme', 'dark');
            }
          });
        }
      </script>
</body>

</html>